<div id="main-wrapper">
    <div class="main-block" id="document-wrapper">
        <ul id="sidenav"></ul>
    </div>
    <div class="main-block" id="module-wrapper">
        <div class="handy-modules"></div>
    </div>
</div>

<script type="text/template" id="handy-module-demo">
    <div class="handy-module-demo">
        <h3 class="handy-module-subtitle">Default</h3>
        <a class="handy-module-sourcecode" href="#" style="display:none">查看源码</a>
        <div class="handy-module-dom"></div>
        <pre class="handy-module-code prettyprint"></pre>
    </div>
</script>
<script type="text/javascript" src="assets/google-code-prettify/prettify.js"></script>
<script type="text/javascript" src="http://static.alipayobjects.com/seajs/1.3.1/sea.js"></script>
<script type="text/javascript">
(function(){
    seajs.config({
        base: 'http://static.alipayobjects.com',
        alias: {
            '$': 'gallery/jquery/1.8.2/jquery',
            'fixed': 'arale/fixed/1.0.0/fixed'
        },
        preload: ['seajs/plugin-combo'],
    });
    seajs.use(['$', 'fixed'], function($, Fixed) {
        Fixed('#document-wrapper');

        var handyComponents = ['button', 'form', 'header', 'icons', 'list', 'loading', 'poptip', 'tipbox', 'tiptext']; 
        
        $.each(handyComponents, function(i, name){
            var id = 'handy-module-' + name,
                li = $('<li><a href="#'+ id +'">'+ name +'</a></li>');
            li.appendTo('#sidenav');

            var module = $('<div class="handy-module"><h2></h2></div>');
            module.attr('id', id)
                .appendTo('.handy-modules');
            $.ajax({
                url: 'components/' + name + '.html',
                dataType: 'html',
                success: function(content) {
                    content = $(content);

                    module.find('h2').html(content.find('h2').html());
                    content.find('.handy-module-demo').each(function(i, item){
                        item = $(item);

                        var demo = $($('#handy-module-demo').html()),
                            subtitle = item.find('h3').html(),
                            html = item.find('.handy-module-dom').html();

                        demo.find('.handy-module-subtitle').html(subtitle);
                        demo.find('.handy-module-dom').html(html);
                        demo.find('.handy-module-code').html(HtmlToCode(html));
                        demo.appendTo(module);
                    });
                }
            }); 
        });
        function HtmlToCode(html) {
            var code = html;
            code = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            code = code.replace(/^\s*\n/, '').replace(/\n\s*$/, '');
            code = PR.prettyPrintOne(code, 'html', false);
            return code;
        }

        // side

        var titles = $('.handy-modules h2');
        var doc = $(document);
        if (titles.length <= 0) {
            return;
        }

        $(window).scroll(function() {
            var top = doc.scrollTop(), i;
            if (top >= doc.height()- $(window).height() - 20) {
                i = titles.length - 1;
            } else {
                for (i=0; i<titles.length; i++) {
                    if (top < titles.eq(i).offset().top - 20) {  
                        break;
                    }
                }
                i--;
                i = (i<0) ? 0 : i;
            }
            $('#sidenav .active').removeClass('active');
            $('#sidenav li').eq(i).addClass('active');
        });
    })
})();
</script>
